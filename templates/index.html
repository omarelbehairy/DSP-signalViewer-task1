<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <div id="plot"></div>
    <div>
        <button id="toggle-btn" onclick="togglePlot()">Start</button>
        <button id="color-btn" onclick="changeColor()">Change Color</button>
        <button id="zoom-in-btn" onclick="zoomIn()">Zoom In</button>
        <label for="interval-slider">Interval:</label>
        <input type="range" id="interval-slider" min="10" max="100" step="10" value="50" oninput="updateInterval(this.value)">
        <label for="y-axis-slider">Y-Axis:</label>
        <input type="range" id="y-axis-slider" min="-1" max="1" step="0.1" value="0" oninput="updateYAxis(this.value)">
    </div>
    <script>
        var plotDiv = document.getElementById('plot');
var data = {{data|tojson}};
var x = [];
var y = data.map(function (x) {return x[1]; });
var cnt = 0;
var intervalId;
var intervalTime = 50;
var plotColor = 'blue';
var yRange = [-1, 1];
var zoomFactor = 2; // zoom factor for zoom in

function plot() {
    Plotly.newPlot(plotDiv, [{x: x, y: y, line: {color: plotColor}}], {title: 'ECG Signal', scrollZoom: true, modeBar: {orientation: 'v'},
                                              xaxis: {range: [Math.max(cnt - 100, 0), cnt]}, yaxis: {range: yRange, dragmode: 'pan'}});
}

function update() {
    // replace with code to get ECG 
    x.push(cnt);
    y.push();
    cnt++;
    plot();

}

function togglePlot() {
    var btn = document.getElementById('toggle-btn');
    
    if (intervalId) {
        // Stop plot updates
        clearInterval(intervalId);
        intervalId = null;
        btn.innerHTML = 'Start';
        // Reset Speed slider
        var slider = document.getElementById('interval-slider');
        slider.value = 50;
        intervalTime = 50;

    } else {
        // Start plot updates
        intervalId = setInterval(update, intervalTime);
        btn.innerHTML = 'Stop';
        
    }
}

function updateInterval(value) {
    intervalTime = value;
    if (intervalId) {
        clearInterval(intervalId);
        intervalId = setInterval(update, intervalTime);
    }
}

function updateYAxis(value) {
    yRange = [value - 1, value + 1];
    plot();
}



function zoomIn() {
    var update = {
        xaxis: {
            range: [
                Math.max(cnt - 100, 0),
                Math.max(cnt - 100, 0) + (cnt - Math.max(cnt - 100, 0)) / zoomFactor
            ]
        }
    };
    Plotly.update(plotDiv, {}, update);
}

// Start plot updates by default
togglePlot();

    </script>
</body>
</html>
