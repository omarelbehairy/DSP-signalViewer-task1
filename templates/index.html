<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <div id="plot"></div>
    <div>
        <input type="file" id="fileInput" onchange="OpenFile(event)">
        <button id="toggle-btn" onclick="togglePlot()">Start</button>
        <button onclick="changeColor()">Change Color</button>
        <button id="zoom-in-btn" onclick="zoomIn()">Zoom</button>
        <label for="interval-slider">Interval:</label>
        <input type="range" id="interval-slider" min="10" max="100" step="10" value="50" oninput="updateInterval(this.value)">
        <label for="y-axis-slider">Y-Axis:</label>
        <input type="range" id="y-axis-slider" min="-1" max="1" step="0.05" value="5" oninput="updateYAxis(this.value)">
    </div>
    <script>
        var plotDiv = document.getElementById('plot');
        var x = [];
        var y = [];
        var cnt = 0;
        var intervalID;
        var plotColor = '#1f77b4'; // Default color
        var yRange = [-1, 1];
        var intervalTime = 50;
        var zoomFactor = 5; // zoom factor for zoom in

        function updateInterval(value) {
            intervalTime = value;
            if (intervalID) {
                clearInterval(intervalID);
                intervalID = setInterval(update, intervalTime);
            }
        }

        function OpenFile(event) {
            var input = event.target;
            var reader = new FileReader();
            reader.onload = function(){
                var lines = reader.result.split('\n');
                for(var i = 0; i < lines.length; i++){
                    var cols = lines[i].split('\t');
                    y.push(parseFloat(cols[1]));
                }
                plot();
            };
            reader.readAsText(input.files[0]);
        }

        function plot() {
            Plotly.newPlot(plotDiv, [{x: x, y: y}], {
            title: 'ECG Signal',
            scrollZoom: true,
            modeBar: {orientation: 'v'},
            xaxis: {range: [Math.max(cnt - 100, 0), cnt]},
            yaxis: {range: yRange}
        });
    }

    function update() {
        x.push(cnt);
        y.push(); // add code to get ECG here
        cnt++;

        // update xaxis range
        var update = {
            xaxis: {
                range: [Math.max(cnt - 100, 0), cnt]
            }
        };

        Plotly.update(plotDiv, {x: [x], y: [y]}, update);
    }

    function togglePlot() {
        var button = document.getElementById("toggle-btn");
        if (button.innerHTML === "Stop") {
            clearInterval(intervalID);
            button.innerHTML = "Play";
            // Reset slider
            var slider = document.getElementById('interval-slider');
                slider.value = 100;
                intervalTime = 100;
        } else {
            intervalID = setInterval(update, 50);
            button.innerHTML = "Stop";
        }
    }

    function changeColor() {
            // Generate a random color
            var randomColor = '#'+(Math.random()*0xFFFFFF<<0).toString(16);

            // Update the plot color
            Plotly.restyle(plotDiv, {line: {color: randomColor}}, 0);
            plotColor = randomColor; // Save the new color for future updates
        }

        function zoomIn() {
  // Determine the current zoom level
  var currentZoom = (plotDiv.layout.xaxis.range[1] - plotDiv.layout.xaxis.range[0]) / 100;

  // Determine the new zoom range
  var newStart = Math.max(cnt - 100, 0);
  var newEnd = Math.max(cnt - 100, 0) + (cnt - Math.max(cnt - 100, 0)) / (zoomFactor * currentZoom);

  // Adjust the zoom range
  var update = {
    xaxis: {
      range: [newStart, newEnd]
    }
  };
  Plotly.update(plotDiv, {}, update);
}


    function updateYAxis(value) {
        yRange = [value - 1, value + 1];
        plot();
    }


    </script>
</body>

</html>
